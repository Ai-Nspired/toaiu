<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ai-nspired Truth Engine</title>
<meta name="description" content="ai-nspired.com • Truth Engine output. Dynamic, professional, toggleable light/dark mode.">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
    @import url('https://fonts.googleapis.com/css2?family=VT323&family=Special+Elite&display=swap');

    :root {
        --bg-dark: #010409;
        --text-dark: #e0e0e0;
        --border-dark: #30363d;
        --modal-bg-dark: #0d1117;

        --bg-light: #f8f8ff;
        --text-light: #1a1a1a;
        --border-light: #ccc;
        --modal-bg-light: #ffffff;

        --accent-silver: #c0c0c0;
    }

    body {
        margin: 0;
        padding: 2rem;
        font-family: 'VT323', monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
        background-color: var(--bg-dark);
        color: var(--text-dark);
        transition: all 0.3s ease;
    }

    .terminal-window {
        width: 100%;
        max-width: 800px;
        text-align: left;
    }

    .typed-text {
        display: inline-block;
        overflow: hidden;
        white-space: nowrap;
        border-right: 3px solid var(--accent-silver);
        animation: typing 3.5s steps(40, end), blink-caret .75s step-end infinite;
    }

    @keyframes typing {
        from { width: 0 }
        to { width: 100% }
    }
    @keyframes blink-caret {
        from, to { border-color: transparent }
        50% { border-color: var(--accent-silver); }
    }

    .command-line {
        display: flex;
        align-items: center;
        margin-top: 0.5rem;
    }
    .command-line::before { content: '>'; margin-right: 1rem; }

    .search-input {
        background: transparent;
        border: none;
        color: inherit;
        font-family: 'VT323', monospace;
        font-size: 1.5rem;
        flex-grow: 1;
        outline: none;
    }

    .modal-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(13, 17, 23, 0.9);
        backdrop-filter: blur(8px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        animation: fadeIn 0.5s ease;
    }
    .modal-overlay.active { display: flex; }

    .modal-container {
        background-color: var(--modal-bg-dark);
        border: 1px solid var(--border-dark);
        border-radius: 8px;
        width: 90%; max-width: 900px; height: 90vh;
        box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        display: flex; flex-direction: column;
    }

    .modal-header {
        display: flex; justify-content: space-between; align-items: center;
        padding: 0.5rem 1.5rem; border-bottom: 1px solid var(--border-dark);
    }
    .modal-title { color: var(--accent-silver); }
    .close-modal { background: none; border: none; color: var(--accent-silver); font-size: 2rem; cursor: pointer; }

    .result-container {
        padding: 2rem;
        flex-grow: 1;
        overflow-y: auto;
        transition: all 0.3s ease;
        font-family: 'Special Elite', cursive;
    }

    .modal-footer {
        display: none;
        padding: 1rem;
        border-top: 1px solid var(--border-dark);
        justify-content: flex-end; gap: 1rem;
    }
    .modal-footer button {
        background: none;
        border: 1px solid var(--accent-silver);
        color: var(--accent-silver);
        font-family: 'VT323', monospace;
        font-size: 1.2rem;
        cursor: pointer;
        padding: 0.5rem 1rem;
    }

    .follow-up-container { margin-top: 1.5rem; }

    .follow-up-container a {
        display: inline-block;
        margin-right: 1rem;
        margin-bottom: 0.5rem;
        padding: 0.4rem 0.8rem;
        background-color: var(--accent-silver);
        color: var(--bg-dark);
        text-decoration: none;
        border-radius: 4px;
        font-family: 'VT323', monospace;
        font-size: 1rem;
        transition: all 0.2s ease;
    }
    .follow-up-container a:hover { background-color: #fff; color: var(--bg-dark); }

    .toggle-button {
        position: fixed;
        top: 1rem;
        right: 1rem;
        background-color: var(--accent-silver);
        color: var(--bg-dark);
        border: none;
        padding: 0.5rem 1rem;
        cursor: pointer;
        font-family: 'VT323', monospace;
        z-index: 2000;
    }

    @keyframes fadeIn { from { opacity: 0 } to { opacity: 1 } }
</style>
</head>
<body>
<button class="toggle-button" id="toggleMode">Toggle Light/Dark</button>

<div class="terminal-window">
    <p class="typed-text">connected. ai-nspired truth-engine ready.</p>
    <div class="command-line">
        <input type="text" class="search-input" id="queryInput" placeholder="Enter query..." autofocus />
    </div>
</div>

<div class="modal-overlay" id="modalOverlay">
    <div class="modal-container">
        <div class="modal-header">
            <p class="modal-title">DATA STREAM // ai-nspired</p>
            <button class="close-modal" id="closeModal">×</button>
        </div>
        <div class="result-container" id="resultContainer"></div>
        <div class="follow-up-container" id="followUpContainer"></div>
        <div class="modal-footer" id="modalFooter">
            <button id="copyBtn">Copy Analysis</button>
            <button id="ttsBtn">TTS (Read Aloud)</button>
        </div>
    </div>
</div>

<script>
const API_URL = 'https://justice.ai-n.workers.dev/api/ai/truth'; 
const queryInput = document.getElementById('queryInput');
const modalOverlay = document.getElementById('modalOverlay');
const closeModal = document.getElementById('closeModal');
const resultContainer = document.getElementById('resultContainer');
const followUpContainer = document.getElementById('followUpContainer');
const modalFooter = document.getElementById('modalFooter');
const copyBtn = document.getElementById('copyBtn');
const ttsBtn = document.getElementById('ttsBtn');
const toggleButton = document.getElementById('toggleMode');

let isLightMode = false;

function openModal() {
    modalOverlay.classList.add('active');
    modalFooter.style.display = 'none';
    followUpContainer.innerHTML = '';
}

function closeModalFunc() {
    modalOverlay.classList.remove('active');
}

function toggleMode() {
    isLightMode = !isLightMode;
    if(isLightMode){
        document.body.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-light');
        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-light');
        modalOverlay.querySelector('.modal-container').style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--modal-bg-light');
        modalFooter.querySelectorAll('button').forEach(b => b.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-light'));
    } else {
        document.body.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--bg-dark');
        document.body.style.color = getComputedStyle(document.documentElement).getPropertyValue('--text-dark');
        modalOverlay.querySelector('.modal-container').style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--modal-bg-dark');
        modalFooter.querySelectorAll('button').forEach(b => b.style.color = getComputedStyle(document.documentElement).getPropertyValue('--accent-silver'));
    }
}

async function performQuery(query) {
    if(!query) return;
    openModal();
    resultContainer.innerHTML = '<p>⚡ Scanning truth matrix...</p>';
    try {
        const resp = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ query })
        });
        const data = await resp.json();
        let html = marked.parse(data.answer || 'No patterns found.');
        resultContainer.innerHTML = html;
        modalFooter.style.display = 'flex';
        if(data.followUp?.length){
            followUpContainer.innerHTML = data.followUp.map(f => `<a href="#" onclick="performQuery('${f.replace(/'/g,"\\'")}')">${f}</a>`).join('');
        }
    } catch(e){
        resultContainer.innerHTML = `<p style="color:#ff3b30">Error: ${e.message}</p>`;
        modalFooter.style.display = 'none';
    }
}

function copyAnalysis() {
    navigator.clipboard.writeText(resultContainer.innerText);
}

function ttsRead() {
    if('speechSynthesis' in window){
        if(window.speechSynthesis.speaking){
            window.speechSynthesis.cancel(); return;
        }
        let utter = new SpeechSynthesisUtterance(resultContainer.innerText);
        utter.rate = 1.1;
        window.speechSynthesis.speak(utter);
    } else { alert('TTS not supported'); }
}

// Event listeners
queryInput.addEventListener('keypress', e => { if(e.key==='Enter') performQuery(queryInput.value.trim()); });
closeModal.addEventListener('click', closeModalFunc);
modalOverlay.addEventListener('click', e => { if(e.target===modalOverlay) closeModalFunc(); });
copyBtn.addEventListener('click', copyAnalysis);
ttsBtn.addEventListener('click', ttsRead);
toggleButton.addEventListener('click', toggleMode);

// Optional: support URL query param
window.addEventListener('load', () => {
    const params = new URLSearchParams(window.location.search);
    const q = params.get('q');
    if(q) performQuery(decodeURIComponent(q.replace(/\+/g,' ')));
});
</script>
</body>
</html>